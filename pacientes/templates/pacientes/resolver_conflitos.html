{% extends 'pacientes/base.html' %}

{% block title %}Resolver Conflitos{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
    <h1 class="h2">Resolver Conflitos de Dados</h1>
    <span class="badge bg-danger fs-5">{{ total_conflitos }} conflito(s)</span>
</div>

{% if total_conflitos > 0 %}
<div class="alert alert-warning">
    <i class="bi bi-exclamation-triangle"></i>
    <strong>Atenção!</strong> Os dados abaixo apresentam conflitos. Escolha qual valor deseja manter para cada campo.
</div>

<form method="post">
    {% csrf_token %}
    
    {% for item in conflitos_por_paciente %}
    <div class="card mb-3">
        <div class="card-header bg-light">
            <h5 class="mb-0">
                <i class="bi bi-person"></i> {{ item.paciente.nome_paciente }}
                <small class="text-muted">(Nasc: {{ item.paciente.data_nascimento|date:"d/m/Y" }})</small>
            </h5>
        </div>
        <div class="card-body">
            {% for conflito in item.conflitos %}
            <div class="border p-3 mb-3 bg-light">
                <h6 class="text-primary">Campo: {{ conflito.campo }}</h6>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="conflito_{{ conflito.id }}" id="existente_{{ conflito.id }}" value="existente" checked>
                    <label class="form-check-label" for="existente_{{ conflito.id }}">
                        <strong>Manter existente:</strong> <span class="text-success">{{ conflito.valor_existente }}</span>
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="conflito_{{ conflito.id }}" id="novo_{{ conflito.id }}" value="novo">
                    <label class="form-check-label" for="novo_{{ conflito.id }}">
                        <strong>Usar novo:</strong> <span class="text-info">{{ conflito.valor_novo }}</span>
                    </label>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
    
    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <a href="{% url 'listar_pacientes' %}" class="btn btn-secondary">Cancelar</a>
        <button type="submit" class="btn btn-primary btn-lg">
            <i class="bi bi-check-circle"></i> Resolver Todos os Conflitos
        </button>
    </div>
</form>
{% else %}
<div class="alert alert-success">
    <i class="bi bi-check-circle"></i>
    <strong>Parabéns!</strong> Não há conflitos pendentes no momento.
</div>
<a href="{% url 'listar_pacientes' %}" class="btn btn-primary">Ver Pacientes</a>
{% endif %}
{% endblock %}

